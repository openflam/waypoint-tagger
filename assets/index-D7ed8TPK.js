(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();AFRAME.registerComponent("way_point",{schema:{ID:{type:"string"},description:{type:"string"},neighbors:{type:"string"}},neighborLines:[],textEntity:null,init:function(){this.neighborLines=[],this.textEntity=document.createElement("a-entity"),this.textEntity.setAttribute("text",{width:5,value:this.data.ID,align:"center"}),this.textEntity.setAttribute("position",{x:0,y:1,z:0}),this.el.appendChild(this.textEntity)},update:function(t){var e=this.data,o=this.el;if(Object.keys(t).length===0&&(t={ID:"init-random-id-do-not-use",description:"",neighbors:""}),e.ID!==t.ID&&(o.setAttribute("id",e.ID),this.textEntity.setAttribute("text",{value:e.ID}),t.ID!=="init-random-id-do-not-use"&&e.neighbors!=="")){var n=e.neighbors.split(",");for(const d of n){var i=o.sceneEl.querySelector("#"+d),r=i.components.way_point,s=r.data.neighbors.split(",");s=s.filter(y=>y!=t.ID),s.push(e.ID),r.data.neighbors=s.join(",")}}if(e.neighbors!==t.neighbors){var a=this.getValidNeighbors(e.neighbors),c=this.getValidNeighbors(t.neighbors),l=c.filter(d=>!a.includes(d)),p=a.filter(d=>!c.includes(d));for(const d of p){var i=o.sceneEl.querySelector("#"+d),r=i.components.way_point,s=r.data.neighbors.split(",");s.length===1&&s[0]===""?r.data.neighbors=e.ID:s.includes(e.ID)||(s.push(e.ID),r.data.neighbors=s.join(",")),this.addLineToNeighbor(d)}for(const d of l){var i=o.sceneEl.querySelector("#"+d),r=i.components.way_point,s=r.data.neighbors.split(",");s=s.filter(h=>h!=e.ID),r.data.neighbors=s.join(","),this.removeLineToNeighbor(d)}}},getValidNeighbors:function(t){return t.split(",").map(n=>n.trim()).filter(n=>n!==""&&this.el.sceneEl.querySelector("#"+n)!==null)},addLineToNeighbor:function(t){var e=this.el.getAttribute("id");const o=e<t?e:t,n=e<t?t:e,i=o+"-"+n;if(!this.el.sceneEl.querySelector("#"+i)){var r=document.createElement("a-entity");r.setAttribute("id",i),r.setAttribute("data-aframe-inspector",""),r.setAttribute("waypoint_connection",{startEntity:"#"+o,endEntity:"#"+n}),this.el.sceneEl.appendChild(r),this.neighborLines.push(r)}},removeLineToNeighbor:function(t){var e=this.el.getAttribute("id");const o=e<t?e:t,n=e<t?t:e,i=o+"-"+n;var r=this.el.sceneEl.querySelector("#"+i);r&&this.el.sceneEl.removeChild(r),this.neighborLines=this.neighborLines.filter(s=>s.getAttribute("id")!=i)}});AFRAME.registerComponent("waypoint_connection",{schema:{startEntity:{type:"selector"},endEntity:{type:"selector"},color:{type:"color",default:"white"},opacity:{type:"number",default:1},linewidth:{type:"number",default:5}},material:null,geometry:null,line:null,init:function(){var t=this.data,e,o;o=this.material=new AFRAME.THREE.LineBasicMaterial({color:t.color,opacity:t.opacity,transparent:t.opacity<1,visible:!0,linewidth:t.linewidth}),e=this.geometry=new AFRAME.THREE.BufferGeometry,e.setAttribute("position",new AFRAME.THREE.BufferAttribute(new Float32Array(2*3),3));var n=e.attributes.position.array;n[0]=t.startEntity.object3D.position.x,n[1]=t.startEntity.object3D.position.y,n[2]=t.startEntity.object3D.position.z,n[3]=t.endEntity.object3D.position.x,n[4]=t.endEntity.object3D.position.y,n[5]=t.endEntity.object3D.position.z,this.line=new AFRAME.THREE.Line(e,o);const i=t.startEntity.getAttribute("id")+"-"+t.endEntity.getAttribute("id");this.el.setObject3D(i,this.line)},tick:function(t,e){var o=this.data,n=this.geometry.attributes.position.array;n[0]=o.startEntity.object3D.position.x,n[1]=o.startEntity.object3D.position.y,n[2]=o.startEntity.object3D.position.z,n[3]=o.endEntity.object3D.position.x,n[4]=o.endEntity.object3D.position.y,n[5]=o.endEntity.object3D.position.z,this.geometry.attributes.position.needsUpdate=!0}});function u(t){return new Promise(e=>{if(document.querySelector(t))return e(document.querySelector(t));const o=new MutationObserver(n=>{document.querySelector(t)&&(o.disconnect(),e(document.querySelector(t)))});o.observe(document.body,{childList:!0,subtree:!0})})}const f=new THREE.DRACOLoader().setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.7/");function b(t){const e=t.target;if(!e.files||e.files.length===0)return;const o=new FileReader;o.addEventListener("load",function(n){const r=n.target.result;m(r)}),o.readAsArrayBuffer(e.files[0])}function m(t){const e=new THREE.GLTFLoader().setDRACOLoader(f),o=new Blob([t],{type:"application/octet-stream"}),n=URL.createObjectURL(o);e.load(n,function(i){window.thisGLTF=i;const r=i.scene||i.scenes[0],s=document.createElement("a-entity");s.setObject3D("mesh",r),s.setAttribute("data-aframe-inspector","");const a=document.querySelector("a-scene");if(!a){console.warn("<a-scene> not found in the DOM.");return}a.appendChild(s)})}function g(t){const e=new FileReader;if(e.addEventListener("load",function(o){if(!o.target||!o.target.result){console.error("Failed to read the file.");return}const n=o.target.result,i=E(n);v(i)}),!t.target||!(t.target instanceof HTMLInputElement)||!t.target.files){console.error("File select event target is not defined.");return}e.readAsText(t.target.files[0])}function E(t){const e=t.split(`
`);e[e.length-1].trim()===""&&e.pop();const o=e[0].split(",");return e.slice(1).map(i=>{const r=i.split(","),s={};return o.forEach((a,c)=>{let l=r[c].trim();l.startsWith('"')&&l.endsWith('"')&&(l=l.slice(1,-1)),s[a.trim()]=l}),s})}function v(t){const e=document.querySelector("a-scene");var o={};t.forEach(n=>{const i=document.createElement("a-entity");i.setAttribute("position",`${n.x} ${n.y} ${n.z}`),i.setAttribute("way_point",{ID:n.id,description:n.description||""}),i.setAttribute("id",n.id),i.setAttribute("gltf-model","#waypoint_model"),e.appendChild(i),o[n.id]=i}),t.forEach(n=>{var i=o[n.id],r=n.neighbors.replaceAll(";",",");i.setAttribute("way_point",{neighbors:r})})}function A(){var t=document.createElement("a-entity");t.setAttribute("class","waypoint"),t.setAttribute("way_point",""),t.setAttribute("gltf-model","#waypoint_model"),t.object3D.position.set(0,.6,0),document.querySelector("a-scene").appendChild(t),AFRAME.INSPECTOR.selectEntity(t)}function w(){var t=document.querySelectorAll("[way_point]"),e=[];for(const c of t)e.push({id:c.getAttribute("id"),x:c.object3D.position.x,y:c.object3D.position.y,z:c.object3D.position.z,neighbors:c.components.way_point.data.neighbors.replaceAll(",",";")});var o=[],n=Object.keys(e[0]);o.push(n.join(","));for(const c of e){var i=n.map(l=>{var p=c[l];return`"${p}"`});o.push(i.join(","))}var r=o.join(`
`),s=new Blob([r],{type:"text/csv"}),a=document.createElement("a");a.download="waypoints_graph.csv",a.href=window.URL.createObjectURL(s),a.style.display="none",document.body.appendChild(a),a.click()}function L(){window.addEventListener("load",()=>{const t=document.querySelector("a-scene");if(!t){console.error("A-Frame scene not found.");return}t.addEventListener("loaded",()=>{if(!t){console.error("A-Frame scene not found.");return}t.components.inspector.openInspector(!0)})})}function D(){u("#add-map-mesh").then(t=>{t.addEventListener("change",b)}),u("#load-waypoints-input").then(t=>{t.addEventListener("change",g)}),u(".add-waypoint").then(t=>{t.addEventListener("click",A)}),u(".download-waypoints").then(t=>{t.addEventListener("click",w)})}function j(){L(),D()}j();
